{"version":3,"file":"EditNotificationChannel.1ebdc265fc3bd7452fcd.js","sources":["webpack:////./public/app/core/components/connectWithCleanUp.tsx","webpack:////./public/app/features/alerting/EditNotificationChannelPage.tsx"],"sourcesContent":["import { connect, MapDispatchToPropsParam, MapStateToPropsParam, useDispatch } from 'react-redux';\nimport { cleanUpAction, StateSelector } from '../actions/cleanUp';\nimport React, { ComponentType, FunctionComponent, useEffect } from 'react';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\n\nexport const connectWithCleanUp = <\n  TStateProps extends {} = {},\n  TDispatchProps = {},\n  TOwnProps = {},\n  State = {},\n  TSelector extends object = {},\n  Statics = {}\n>(\n  mapStateToProps: MapStateToPropsParam<TStateProps, TOwnProps, State>,\n  mapDispatchToProps: MapDispatchToPropsParam<TDispatchProps, TOwnProps>,\n  stateSelector: StateSelector<TSelector>\n) => (Component: ComponentType<any>) => {\n  const ConnectedComponent = connect(\n    mapStateToProps,\n    mapDispatchToProps\n    // @ts-ignore\n  )(Component);\n\n  const ConnectedComponentWithCleanUp: FunctionComponent = props => {\n    const dispatch = useDispatch();\n    useEffect(() => {\n      return function cleanUp() {\n        dispatch(cleanUpAction({ stateSelector }));\n      };\n    }, []);\n    // @ts-ignore\n    return <ConnectedComponent {...props} />;\n  };\n\n  ConnectedComponentWithCleanUp.displayName = `ConnectWithCleanUp(${ConnectedComponent.displayName})`;\n  hoistNonReactStatics(ConnectedComponentWithCleanUp, Component);\n  type Hoisted = typeof ConnectedComponentWithCleanUp & Statics;\n\n  return ConnectedComponentWithCleanUp as Hoisted;\n};\n","import React, { PureComponent } from 'react';\nimport { MapDispatchToProps, MapStateToProps } from 'react-redux';\nimport { NavModel } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { Form, Spinner } from '@grafana/ui';\nimport Page from 'app/core/components/Page/Page';\nimport { connectWithCleanUp } from 'app/core/components/connectWithCleanUp';\nimport { NotificationChannelForm } from './components/NotificationChannelForm';\nimport {\n  loadNotificationChannel,\n  loadNotificationTypes,\n  testNotificationChannel,\n  updateNotificationChannel,\n} from './state/actions';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { getRouteParamsId } from 'app/core/selectors/location';\nimport { mapChannelsToSelectableValue, transformSubmitData, transformTestData } from './utils/notificationChannels';\nimport { NotificationChannelType, NotificationChannelDTO, StoreState } from 'app/types';\nimport { resetSecureField } from './state/reducers';\n\ninterface OwnProps {}\n\ninterface ConnectedProps {\n  navModel: NavModel;\n  channelId: number;\n  notificationChannel: any;\n  notificationChannelTypes: NotificationChannelType[];\n}\n\ninterface DispatchProps {\n  loadNotificationTypes: typeof loadNotificationTypes;\n  loadNotificationChannel: typeof loadNotificationChannel;\n  testNotificationChannel: typeof testNotificationChannel;\n  updateNotificationChannel: typeof updateNotificationChannel;\n  resetSecureField: typeof resetSecureField;\n}\n\ntype Props = OwnProps & ConnectedProps & DispatchProps;\n\nexport class EditNotificationChannelPage extends PureComponent<Props> {\n  componentDidMount() {\n    const { channelId } = this.props;\n\n    this.props.loadNotificationTypes();\n    this.props.loadNotificationChannel(channelId);\n  }\n\n  onSubmit = (formData: NotificationChannelDTO) => {\n    const { notificationChannel } = this.props;\n\n    this.props.updateNotificationChannel({\n      /*\n       Some settings which lives in a collapsed section will not be registered since\n       the section will not be rendered if a user doesn't expand it. Therefore we need to\n       merge the initialData with any changes from the form.\n      */\n      ...transformSubmitData({\n        ...notificationChannel,\n        ...formData,\n        settings: { ...notificationChannel.settings, ...formData.settings },\n      }),\n      id: notificationChannel.id,\n    });\n  };\n\n  onTestChannel = (formData: NotificationChannelDTO) => {\n    const { notificationChannel } = this.props;\n    /*\n      Same as submit\n     */\n    this.props.testNotificationChannel(\n      transformTestData({\n        ...notificationChannel,\n        ...formData,\n        settings: { ...notificationChannel.settings, ...formData.settings },\n      })\n    );\n  };\n\n  render() {\n    const { navModel, notificationChannel, notificationChannelTypes } = this.props;\n\n    return (\n      <Page navModel={navModel}>\n        <Page.Contents>\n          <h2 className=\"page-sub-heading\">Edit notification channel</h2>\n          {notificationChannel && notificationChannel.id > 0 ? (\n            <Form\n              maxWidth={600}\n              onSubmit={this.onSubmit}\n              defaultValues={{\n                ...notificationChannel,\n                type: notificationChannelTypes.find(n => n.value === notificationChannel.type),\n              }}\n            >\n              {({ control, errors, getValues, register, watch }) => {\n                const selectedChannel = notificationChannelTypes.find(c => c.value === getValues().type.value);\n\n                return (\n                  <NotificationChannelForm\n                    selectableChannels={mapChannelsToSelectableValue(notificationChannelTypes)}\n                    selectedChannel={selectedChannel}\n                    imageRendererAvailable={config.rendererAvailable}\n                    onTestChannel={this.onTestChannel}\n                    register={register}\n                    watch={watch}\n                    errors={errors}\n                    getValues={getValues}\n                    control={control}\n                    resetSecureField={this.props.resetSecureField}\n                    secureFields={notificationChannel.secureFields}\n                  />\n                );\n              }}\n            </Form>\n          ) : (\n            <div>\n              Loading notification channel\n              <Spinner />\n            </div>\n          )}\n        </Page.Contents>\n      </Page>\n    );\n  }\n}\n\nconst mapStateToProps: MapStateToProps<ConnectedProps, OwnProps, StoreState> = state => {\n  const channelId = getRouteParamsId(state.location) as number;\n  return {\n    navModel: getNavModel(state.navIndex, 'channels'),\n    channelId,\n    notificationChannel: state.notificationChannel.notificationChannel,\n    notificationChannelTypes: state.notificationChannel.notificationChannelTypes,\n  };\n};\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, OwnProps> = {\n  loadNotificationTypes,\n  loadNotificationChannel,\n  testNotificationChannel,\n  updateNotificationChannel,\n  resetSecureField,\n};\n\nexport default connectWithCleanUp(\n  mapStateToProps,\n  mapDispatchToProps,\n  state => state.notificationChannel\n)(EditNotificationChannelPage);\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAYA;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAlCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACLA;AAGA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AAEA;AAqBA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAQA;AACA;AAEA;AASA;AAHA;AAKA;AAXA;AAaA;AACA;AAzBA;AA0BA;AAEA;;;;AAGA;AAIA;AAHA;AAMA;AACA;AAvCA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AANA;AAAA;AAAA;AAwCA;AACA;AADA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAEA;AAAA;AAGA;AACA;AACA;AAEA;AAAA;AAAA;AAFA;AAHA;AAQA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAcA;AAWA;AArFA;AACA;AADA;AAAA;AACA;AAuFA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAQA;AAGA;AAAA;;;;A","sourceRoot":""}